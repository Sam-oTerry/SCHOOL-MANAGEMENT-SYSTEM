<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management - System Administrator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="../../assets/css/main.css" rel="stylesheet">
    <link href="../../assets/css/components/sidebar.css" rel="stylesheet">
    <link href="../../assets/css/users/system-admin.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar" style="z-index: 1000;">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <img src="../../assets/images/logo.png" alt="School Logo" class="img-fluid mb-2" style="max-height: 60px;">
                        <h6 class="text-muted">System Administrator</h6>
                        <small class="text-muted">Staff ID: SYS1234</small>
                    </div>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="system-dashboard.html">
                                <i class="fas fa-tachometer-alt"></i> System Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="user-management.html">
                                <i class="fas fa-users"></i> User Management
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="announcements.html">
                                <i class="fas fa-bullhorn"></i> Announcements
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="academic-calendar.html">
                                <i class="fas fa-calendar-alt"></i> Academic Calendar
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="student-management.html">
                                <i class="fas fa-user-graduate"></i> Student Management
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="staff-management.html">
                                <i class="fas fa-chalkboard-teacher"></i> Staff Management
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="system-settings.html">
                                <i class="fas fa-cog"></i> System Settings
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="term-management.html">
                                <i class="fas fa-calendar"></i> Term Management
                            </a>
                        </li>
                    </ul>
                    
                    <div class="mt-auto p-3 text-center">
                        <button class="btn btn-sm btn-outline-light" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <div class="header">
                    <div>
                        <h4>User Management</h4>
                        <span class="role-badge">System Management</span>
                    </div>
                    <div>
                        <span id="current-user">John Doe</span>
                        <i class="fas fa-user-circle ms-2 text-primary"></i>
                    </div>
                </div>
                
                <!-- User Management Controls -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>User Management Controls</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <label class="form-label">User Role</label>
                                <select class="form-select" id="role-filter" onchange="filterUsers()">
                                    <option value="">All Roles</option>
                                    <option value="head-teacher">Head Teacher</option>
                                    <option value="system-admin">System Administrator</option>
                                    <option value="dos">Director of Studies</option>
                                    <option value="bursar">Bursar</option>
                                    <option value="class-teacher">Class Teacher</option>
                                    <option value="subject-teacher">Subject Teacher</option>
                                    <option value="hod">Head of Department</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="status-filter" onchange="filterUsers()">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="suspended">Suspended</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Search</label>
                                <input type="text" class="form-control" id="search-users" placeholder="Search users...">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Actions</label>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createUserModal">
                                        <i class="fas fa-plus"></i> Create User
                                    </button>
                                    <button class="btn btn-info btn-sm" onclick="exportUsers()">
                                        <i class="fas fa-download"></i> Export
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- User Summary -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>User Summary</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="card bg-primary text-white text-center">
                                    <div class="card-body">
                                        <h3>45</h3>
                                        <p class="mb-0">Total Users</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-success text-white text-center">
                                    <div class="card-body">
                                        <h3>42</h3>
                                        <p class="mb-0">Active Users</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-warning text-white text-center">
                                    <div class="card-body">
                                        <h3>2</h3>
                                        <p class="mb-0">Suspended</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-info text-white text-center">
                                    <div class="card-body">
                                        <h3>1</h3>
                                        <p class="mb-0">New This Week</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Users List -->
                <div class="card">
                    <div class="card-header">
                        <h5>Users List</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>User ID</th>
                                        <th>Username</th>
                                        <th>Full Name</th>
                                        <th>Role</th>
                                        <th>Email</th>
                                        <th>Last Login</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="users-tbody">
                                    <!-- Users will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Create User Modal -->
    <div class="modal fade" id="createUserModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="create-user-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">First Name</label>
                                    <input type="text" class="form-control" id="first-name" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Last Name</label>
                                    <input type="text" class="form-control" id="last-name" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Username</label>
                                    <input type="text" class="form-control" id="username" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="email" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Password</label>
                                    <input type="password" class="form-control" id="password" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Confirm Password</label>
                                    <input type="password" class="form-control" id="confirm-password" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Role</label>
                                    <select class="form-select" id="user-role" required>
                                        <option value="">Select Role</option>
                                        <option value="head-teacher">Head Teacher</option>
                                        <option value="system-admin">System Administrator</option>
                                        <option value="dos">Director of Studies</option>
                                        <option value="bursar">Bursar</option>
                                        <option value="class-teacher">Class Teacher</option>
                                        <option value="subject-teacher">Subject Teacher</option>
                                        <option value="hod">Head of Department</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Phone</label>
                                    <input type="tel" class="form-control" id="phone" placeholder="+256 700 123 456">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Department</label>
                            <select class="form-select" id="department">
                                <option value="">Select Department</option>
                                <option value="administration">Administration</option>
                                <option value="teaching">Teaching</option>
                                <option value="support">Support Staff</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="send-email">
                                <label class="form-check-label" for="send-email">
                                    Send welcome email with login credentials
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createUser()">Create User</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Detail Modal -->
    <div class="modal fade" id="userDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">User Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <p><strong>User ID:</strong> <span id="detail-user-id"></span></p>
                            <p><strong>Username:</strong> <span id="detail-username"></span></p>
                            <p><strong>Full Name:</strong> <span id="detail-full-name"></span></p>
                            <p><strong>Role:</strong> <span id="detail-role"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Email:</strong> <span id="detail-email"></span></p>
                            <p><strong>Phone:</strong> <span id="detail-phone"></span></p>
                            <p><strong>Last Login:</strong> <span id="detail-last-login"></span></p>
                            <p><strong>Status:</strong> <span id="detail-status"></span></p>
                        </div>
                    </div>
                    <div class="mb-3">
                        <p><strong>Department:</strong> <span id="detail-department"></span></p>
                        <p><strong>Created:</strong> <span id="detail-created"></span></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="editUser()">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button type="button" class="btn btn-warning" onclick="resetPassword()">
                        <i class="fas fa-key"></i> Reset Password
                    </button>
                    <button type="button" class="btn btn-danger" onclick="deleteUser()">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/main.js"></script>
    <script src="../../assets/js/users/system-admin.js"></script>
    <script>
        // User Management Functionality
        let users = [];
        let currentUserId = 1001;
        
        // Sample users data
        const sampleUsers = [
            {
                id: 'USR1001',
                username: 'john.smith',
                firstName: 'John',
                lastName: 'Smith',
                email: 'john.smith@school.edu',
                phone: '+256 700 123 456',
                role: 'Head Teacher',
                department: 'Administration',
                status: 'Active',
                lastLogin: '2023-10-15 14:30:00',
                created: '2023-01-15 09:00:00'
            },
            {
                id: 'USR1002',
                username: 'mary.johnson',
                firstName: 'Mary',
                lastName: 'Johnson',
                email: 'mary.johnson@school.edu',
                phone: '+256 700 123 457',
                role: 'Director of Studies',
                department: 'Administration',
                status: 'Active',
                lastLogin: '2023-10-15 13:45:00',
                created: '2023-02-01 10:30:00'
            },
            {
                id: 'USR1003',
                username: 'peter.brown',
                firstName: 'Peter',
                lastName: 'Brown',
                email: 'peter.brown@school.edu',
                phone: '+256 700 123 458',
                role: 'Bursar',
                department: 'Administration',
                status: 'Active',
                lastLogin: '2023-10-15 12:20:00',
                created: '2023-03-01 11:15:00'
            },
            {
                id: 'USR1004',
                username: 'sarah.wilson',
                firstName: 'Sarah',
                lastName: 'Wilson',
                email: 'sarah.wilson@school.edu',
                phone: '+256 700 123 459',
                role: 'Class Teacher',
                department: 'Teaching',
                status: 'Active',
                lastLogin: '2023-10-15 11:30:00',
                created: '2023-04-01 08:45:00'
            },
            {
                id: 'USR1005',
                username: 'david.davis',
                firstName: 'David',
                lastName: 'Davis',
                email: 'david.davis@school.edu',
                phone: '+256 700 123 460',
                role: 'Subject Teacher',
                department: 'Teaching',
                status: 'Suspended',
                lastLogin: '2023-10-10 16:20:00',
                created: '2023-05-01 14:00:00'
            }
        ];
        
        function initializeUserManagement() {
            users = [...sampleUsers];
            displayUsers();
        }
        
        function displayUsers() {
            const tbody = document.getElementById('users-tbody');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.firstName} ${user.lastName}</td>
                    <td><span class="badge ${getRoleColor(user.role)}">${user.role}</span></td>
                    <td>${user.email}</td>
                    <td>${formatDate(user.lastLogin)}</td>
                    <td><span class="badge ${getStatusColor(user.status)}">${user.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewUser('${user.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-warning" onclick="editUser('${user.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteUser('${user.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function getRoleColor(role) {
            switch(role.toLowerCase()) {
                case 'head teacher': return 'bg-primary';
                case 'system administrator': return 'bg-danger';
                case 'director of studies': return 'bg-info';
                case 'bursar': return 'bg-warning';
                case 'class teacher': return 'bg-success';
                case 'subject teacher': return 'bg-secondary';
                case 'head of department': return 'bg-dark';
                default: return 'bg-light text-dark';
            }
        }
        
        function getStatusColor(status) {
            switch(status.toLowerCase()) {
                case 'active': return 'bg-success';
                case 'inactive': return 'bg-secondary';
                case 'suspended': return 'bg-danger';
                default: return 'bg-warning';
            }
        }
        
        function createUser() {
            const firstName = document.getElementById('first-name').value;
            const lastName = document.getElementById('last-name').value;
            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            const role = document.getElementById('user-role').value;
            const phone = document.getElementById('phone').value;
            const department = document.getElementById('department').value;
            const sendEmail = document.getElementById('send-email').checked;
            
            if (!firstName || !lastName || !username || !email || !password || !confirmPassword || !role) {
                alert('Please fill in all required fields.');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match.');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters long.');
                return;
            }
            
            const newUser = {
                id: 'USR' + String(currentUserId++).padStart(4, '0'),
                username,
                firstName,
                lastName,
                email,
                phone,
                role: role.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase()),
                department: department.charAt(0).toUpperCase() + department.slice(1),
                status: 'Active',
                lastLogin: 'Never',
                created: new Date().toISOString().replace('T', ' ').substring(0, 19)
            };
            
            users.push(newUser);
            displayUsers();
            
            // Close modal and reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById('createUserModal'));
            modal.hide();
            document.getElementById('create-user-form').reset();
            
            if (sendEmail) {
                showNotification('User created and welcome email sent!', 'success');
            } else {
                showNotification('User created successfully!', 'success');
            }
        }
        
        function viewUser(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            // Populate modal
            document.getElementById('detail-user-id').textContent = user.id;
            document.getElementById('detail-username').textContent = user.username;
            document.getElementById('detail-full-name').textContent = `${user.firstName} ${user.lastName}`;
            document.getElementById('detail-role').textContent = user.role;
            document.getElementById('detail-email').textContent = user.email;
            document.getElementById('detail-phone').textContent = user.phone || 'Not provided';
            document.getElementById('detail-last-login').textContent = user.lastLogin;
            document.getElementById('detail-status').textContent = user.status;
            document.getElementById('detail-department').textContent = user.department;
            document.getElementById('detail-created').textContent = formatDate(user.created);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('userDetailModal'));
            modal.show();
        }
        
        function editUser(userId) {
            if (userId) {
                const user = users.find(u => u.id === userId);
                if (user) {
                    alert(`Edit User:\n\nName: ${user.firstName} ${user.lastName}\nRole: ${user.role}\n\nThis feature will open the edit form for the user.`);
                }
            } else {
                alert('Edit User feature:\n\nThis will open the edit form for the user.');
            }
        }
        
        function resetPassword(userId) {
            if (userId) {
                const user = users.find(u => u.id === userId);
                if (user) {
                    if (confirm(`Reset password for ${user.firstName} ${user.lastName}?`)) {
                        showNotification('Password reset email sent to user!', 'success');
                    }
                }
            } else {
                if (confirm('Reset password for this user?')) {
                    showNotification('Password reset email sent to user!', 'success');
                }
            }
        }
        
        function deleteUser(userId) {
            if (userId) {
                if (confirm('Are you sure you want to delete this user?')) {
                    users = users.filter(u => u.id !== userId);
                    displayUsers();
                    showNotification('User deleted successfully!', 'success');
                }
            } else {
                if (confirm('Are you sure you want to delete this user?')) {
                    showNotification('User deleted successfully!', 'success');
                    
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('userDetailModal'));
                    modal.hide();
                }
            }
        }
        
        function filterUsers() {
            const roleFilter = document.getElementById('role-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            const searchTerm = document.getElementById('search-users').value.toLowerCase();
            
            let filteredUsers = users;
            
            if (roleFilter) {
                filteredUsers = filteredUsers.filter(u => 
                    u.role.toLowerCase().replace(' ', '-') === roleFilter.toLowerCase()
                );
            }
            
            if (statusFilter) {
                filteredUsers = filteredUsers.filter(u => u.status.toLowerCase() === statusFilter.toLowerCase());
            }
            
            if (searchTerm) {
                filteredUsers = filteredUsers.filter(u => 
                    u.firstName.toLowerCase().includes(searchTerm) ||
                    u.lastName.toLowerCase().includes(searchTerm) ||
                    u.username.toLowerCase().includes(searchTerm) ||
                    u.email.toLowerCase().includes(searchTerm)
                );
            }
            
            displayFilteredUsers(filteredUsers);
        }
        
        function displayFilteredUsers(filteredUsers) {
            const tbody = document.getElementById('users-tbody');
            tbody.innerHTML = '';
            
            filteredUsers.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.firstName} ${user.lastName}</td>
                    <td><span class="badge ${getRoleColor(user.role)}">${user.role}</span></td>
                    <td>${user.email}</td>
                    <td>${formatDate(user.lastLogin)}</td>
                    <td><span class="badge ${getStatusColor(user.status)}">${user.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewUser('${user.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-warning" onclick="editUser('${user.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteUser('${user.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function exportUsers() {
            alert('Export Users feature:\n\nThis will download the users list as an Excel file for backup or external use.');
        }
        
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '../../index.html';
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeUserManagement();
        });
    </script>
</body>
</html>
