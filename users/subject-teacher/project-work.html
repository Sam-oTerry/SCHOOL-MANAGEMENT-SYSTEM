<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Work - Subject Teacher</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="../../assets/css/main.css" rel="stylesheet">
    <link href="../../assets/css/components/sidebar.css" rel="stylesheet">
    <link href="../../assets/css/users/subject-teacher.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar" style="z-index: 1000;">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <img src="../../assets/images/logo.png" alt="School Logo" class="img-fluid mb-2" style="max-height: 60px;">
                        <h6 class="text-muted">Subject Teacher</h6>
                        <small class="text-muted">Staff ID: ST1234</small>
                    </div>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="dashboard.html">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="my-subjects.html">
                                <i class="fas fa-book"></i> My Subjects
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="grade-entry.html">
                                <i class="fas fa-edit"></i> Grade Entry
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="student-lists.html">
                                <i class="fas fa-users"></i> Student Lists
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="project-work.html">
                                <i class="fas fa-tasks"></i> Project Work
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="results-analysis.html">
                                <i class="fas fa-chart-bar"></i> Results Analysis
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="announcements.html">
                                <i class="fas fa-bullhorn"></i> Announcements
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="timetable.html">
                                <i class="fas fa-calendar"></i> Timetable
                            </a>
                        </li>
                    </ul>
                    
                    <div class="mt-auto p-3 text-center">
                        <button class="btn btn-sm btn-outline-light" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <div class="header">
                    <div>
                        <h4>Project Work</h4>
                        <span class="role-badge">Subject Teacher</span>
                    </div>
                    <div>
                        <span id="current-user">John Doe</span>
                        <i class="fas fa-user-circle ms-2 text-primary"></i>
                    </div>
                </div>
                
                <!-- Add Project Button -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5>Project Management</h5>
                    <button class="btn btn-primary" onclick="showAddProjectModal()">
                        <i class="fas fa-plus"></i> Add Project
                    </button>
                </div>
                
                <!-- Projects List -->
                <div class="card">
                    <div class="card-header">
                        <h5>Current Projects</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="projects-table">
                                <thead>
                                    <tr>
                                        <th>Project Title</th>
                                        <th>Subject</th>
                                        <th>Class</th>
                                        <th>Due Date</th>
                                        <th>Students</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="projects-tbody">
                                    <!-- Projects will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Project Submissions -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5>Project Submissions</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="submissions-table">
                                <thead>
                                    <tr>
                                        <th>Student</th>
                                        <th>Project</th>
                                        <th>Subject</th>
                                        <th>Submission Date</th>
                                        <th>Status</th>
                                        <th>Score</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="submissions-tbody">
                                    <!-- Submissions will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Add Project Modal -->
    <div class="modal fade" id="addProjectModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Project</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="add-project-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Project Title</label>
                                    <input type="text" class="form-control" id="project-title" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Subject</label>
                                    <select class="form-select" id="project-subject" required>
                                        <option value="">Select Subject</option>
                                        <option value="mathematics">Mathematics</option>
                                        <option value="physics">Physics</option>
                                        <option value="chemistry">Chemistry</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Class</label>
                                    <select class="form-select" id="project-class" required>
                                        <option value="">Select Class</option>
                                        <option value="s4-science-a">S.4 Science A</option>
                                        <option value="s4-science-b">S.4 Science B</option>
                                        <option value="s3-science">S.3 Science</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Due Date</label>
                                    <input type="date" class="form-control" id="project-due-date" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Total Marks</label>
                                    <input type="number" class="form-control" id="project-marks" min="1" max="100" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Project Type</label>
                                    <select class="form-select" id="project-type" required>
                                        <option value="">Select Type</option>
                                        <option value="individual">Individual</option>
                                        <option value="group">Group</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Project Description</label>
                            <textarea class="form-control" id="project-description" rows="4" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Instructions</label>
                            <textarea class="form-control" id="project-instructions" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addProject()">Add Project</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Grade Project Modal -->
    <div class="modal fade" id="gradeProjectModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Grade Project</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="grade-project-form">
                        <div class="mb-3">
                            <label class="form-label">Student</label>
                            <input type="text" class="form-control" id="grade-student" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Project</label>
                            <input type="text" class="form-control" id="grade-project" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Score (out of <span id="max-marks">100</span>)</label>
                            <input type="number" class="form-control" id="project-score" min="0" max="100" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Comments</label>
                            <textarea class="form-control" id="project-comments" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitGrade()">Submit Grade</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/main.js"></script>
    <script src="../../assets/js/users/subject-teacher.js"></script>
    <script>
        // Project Work Functionality
        let projects = [];
        let submissions = [];
        
        // Sample data
        const sampleProjects = [
            {
                id: 'P001',
                title: 'Quadratic Equations Project',
                subject: 'Mathematics',
                class: 'S.4 Science A',
                dueDate: '2023-11-15',
                totalMarks: 50,
                type: 'Individual',
                description: 'Solve and analyze quadratic equations',
                instructions: 'Submit written solutions and analysis',
                status: 'Active',
                students: 35
            },
            {
                id: 'P002',
                title: 'Physics Lab Report',
                subject: 'Physics',
                class: 'S.4 Science B',
                dueDate: '2023-11-20',
                totalMarks: 40,
                type: 'Individual',
                description: 'Write a comprehensive lab report',
                instructions: 'Include methodology, results, and conclusions',
                status: 'Active',
                students: 32
            },
            {
                id: 'P003',
                title: 'Chemical Reactions Project',
                subject: 'Chemistry',
                class: 'S.3 Science',
                dueDate: '2023-11-25',
                totalMarks: 60,
                type: 'Group',
                description: 'Research and present chemical reactions',
                instructions: 'Group presentation with visual aids',
                status: 'Active',
                students: 38
            }
        ];
        
        const sampleSubmissions = [
            {
                id: 'S001',
                studentId: 'S00123',
                studentName: 'Mukasa John',
                projectId: 'P001',
                projectTitle: 'Quadratic Equations Project',
                subject: 'Mathematics',
                submissionDate: '2023-11-14',
                status: 'Submitted',
                score: null,
                comments: null
            },
            {
                id: 'S002',
                studentId: 'S00124',
                studentName: 'Nakato Mary',
                projectId: 'P001',
                projectTitle: 'Quadratic Equations Project',
                subject: 'Mathematics',
                submissionDate: '2023-11-13',
                status: 'Graded',
                score: 45,
                comments: 'Excellent work with detailed analysis'
            },
            {
                id: 'S003',
                studentId: 'S00125',
                studentName: 'Okot David',
                projectId: 'P002',
                projectTitle: 'Physics Lab Report',
                subject: 'Physics',
                submissionDate: '2023-11-19',
                status: 'Submitted',
                score: null,
                comments: null
            }
        ];
        
        function initializeProjects() {
            projects = [...sampleProjects];
            submissions = [...sampleSubmissions];
            displayProjects();
            displaySubmissions();
        }
        
        function displayProjects() {
            const tbody = document.getElementById('projects-tbody');
            tbody.innerHTML = '';
            
            projects.forEach(project => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <strong>${project.title}</strong>
                        <br><small class="text-muted">${project.description}</small>
                    </td>
                    <td>${project.subject}</td>
                    <td>${project.class}</td>
                    <td>${project.dueDate}</td>
                    <td>${project.students} students</td>
                    <td><span class="badge ${getProjectStatusColor(project.status)}">${project.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewProject('${project.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-warning" onclick="editProject('${project.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteProject('${project.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function displaySubmissions() {
            const tbody = document.getElementById('submissions-tbody');
            tbody.innerHTML = '';
            
            submissions.forEach(submission => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="student-avatar me-2">${submission.studentName.split(' ').map(n => n[0]).join('')}</div>
                            <div>
                                <strong>${submission.studentName}</strong>
                                <br><small class="text-muted">${submission.studentId}</small>
                            </div>
                        </div>
                    </td>
                    <td>${submission.projectTitle}</td>
                    <td>${submission.subject}</td>
                    <td>${submission.submissionDate}</td>
                    <td><span class="badge ${getSubmissionStatusColor(submission.status)}">${submission.status}</span></td>
                    <td>${submission.score ? `${submission.score}/100` : '-'}</td>
                    <td>
                        ${submission.status === 'Submitted' ? `
                            <button class="btn btn-sm btn-outline-success" onclick="gradeProject('${submission.id}')">
                                <i class="fas fa-check"></i> Grade
                            </button>
                        ` : `
                            <button class="btn btn-sm btn-outline-primary" onclick="viewGrade('${submission.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                        `}
                        <button class="btn btn-sm btn-outline-info" onclick="viewSubmission('${submission.id}')">
                            <i class="fas fa-file"></i> File
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function getProjectStatusColor(status) {
            const colors = {
                'Active': 'bg-success',
                'Completed': 'bg-primary',
                'Cancelled': 'bg-danger'
            };
            return colors[status] || 'bg-secondary';
        }
        
        function getSubmissionStatusColor(status) {
            const colors = {
                'Submitted': 'bg-warning',
                'Graded': 'bg-success',
                'Late': 'bg-danger'
            };
            return colors[status] || 'bg-secondary';
        }
        
        function showAddProjectModal() {
            const modal = new bootstrap.Modal(document.getElementById('addProjectModal'));
            modal.show();
        }
        
        function addProject() {
            const title = document.getElementById('project-title').value;
            const subject = document.getElementById('project-subject').value;
            const classSelect = document.getElementById('project-class').value;
            const dueDate = document.getElementById('project-due-date').value;
            const marks = document.getElementById('project-marks').value;
            const type = document.getElementById('project-type').value;
            const description = document.getElementById('project-description').value;
            const instructions = document.getElementById('project-instructions').value;
            
            if (!title || !subject || !classSelect || !dueDate || !marks || !type || !description) {
                alert('Please fill in all required fields');
                return;
            }
            
            const newProject = {
                id: 'P' + (projects.length + 1).toString().padStart(3, '0'),
                title: title,
                subject: subject,
                class: classSelect,
                dueDate: dueDate,
                totalMarks: parseInt(marks),
                type: type,
                description: description,
                instructions: instructions,
                status: 'Active',
                students: 0
            };
            
            projects.push(newProject);
            displayProjects();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addProjectModal'));
            modal.hide();
            
            // Reset form
            document.getElementById('add-project-form').reset();
            
            alert('Project added successfully!');
        }
        
        function viewProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (project) {
                alert(`Project Details:\n\nTitle: ${project.title}\nSubject: ${project.subject}\nClass: ${project.class}\nDue Date: ${project.dueDate}\nDescription: ${project.description}`);
            }
        }
        
        function editProject(projectId) {
            alert(`Edit project: ${projectId}`);
        }
        
        function deleteProject(projectId) {
            if (confirm('Are you sure you want to delete this project?')) {
                projects = projects.filter(p => p.id !== projectId);
                displayProjects();
                alert('Project deleted successfully!');
            }
        }
        
        function gradeProject(submissionId) {
            const submission = submissions.find(s => s.id === submissionId);
            if (submission) {
                document.getElementById('grade-student').value = submission.studentName;
                document.getElementById('grade-project').value = submission.projectTitle;
                document.getElementById('max-marks').textContent = '100';
                document.getElementById('project-score').value = '';
                document.getElementById('project-comments').value = '';
                
                const modal = new bootstrap.Modal(document.getElementById('gradeProjectModal'));
                modal.show();
            }
        }
        
        function submitGrade() {
            const score = document.getElementById('project-score').value;
            const comments = document.getElementById('project-comments').value;
            
            if (!score) {
                alert('Please enter a score');
                return;
            }
            
            // Update submission
            const submissionId = submissions.find(s => s.status === 'Submitted').id;
            const submission = submissions.find(s => s.id === submissionId);
            if (submission) {
                submission.score = parseInt(score);
                submission.comments = comments;
                submission.status = 'Graded';
            }
            
            displaySubmissions();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('gradeProjectModal'));
            modal.hide();
            
            alert('Grade submitted successfully!');
        }
        
        function viewGrade(submissionId) {
            const submission = submissions.find(s => s.id === submissionId);
            if (submission) {
                alert(`Grade Details:\n\nStudent: ${submission.studentName}\nProject: ${submission.projectTitle}\nScore: ${submission.score}/100\nComments: ${submission.comments}`);
            }
        }
        
        function viewSubmission(submissionId) {
            alert(`Viewing submission file for: ${submissionId}`);
        }
        
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '../../index.html';
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeProjects();
        });
    </script>
</body>
</html>
