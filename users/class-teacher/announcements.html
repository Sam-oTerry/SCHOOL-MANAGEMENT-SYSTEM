<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Announcements - Class Teacher</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="../../assets/css/main.css" rel="stylesheet">
    <link href="../../assets/css/components/sidebar.css" rel="stylesheet">
    <link href="../../assets/css/users/class-teacher.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar" style="z-index: 1000;">
                <div class="position-sticky pt-3 d-flex flex-column h-100">
                    <div class="text-center mb-4">
                        <img src="../../assets/images/logo.png" alt="School Logo" class="img-fluid mb-2" style="max-height: 60px;">
                        <h6 class="text-muted">Class Teacher</h6>
                        <small class="text-muted">Staff ID: CT1234</small>
                    </div>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="dashboard.html">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="my-subjects.html">
                                <i class="fas fa-book"></i> My Subjects
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="student-management.html">
                                <i class="fas fa-users"></i> Student Management
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="grade-entry.html">
                                <i class="fas fa-edit"></i> Grade Entry
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="report-cards.html">
                                <i class="fas fa-file-alt"></i> Report Cards
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="class-performance.html">
                                <i class="fas fa-chart-line"></i> Class Performance
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="announcements.html">
                                <i class="fas fa-bullhorn"></i> Announcements
                            </a>
                        </li>
                    </ul>
                    
                    <div class="mt-auto p-3 text-center">
                        <button class="btn btn-sm btn-outline-light" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <div class="header">
                    <div>
                        <h4>Announcements</h4>
                        <span class="role-badge">Class Teacher</span>
                    </div>
                    <div>
                        <span id="current-user">John Doe</span>
                        <i class="fas fa-user-circle ms-2 text-primary"></i>
                    </div>
                </div>
                
                <!-- Announcement Controls -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Announcement Management</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <label class="form-label">Filter by Type</label>
                                <select class="form-select" id="type-filter" onchange="filterAnnouncements()">
                                    <option value="">All Types</option>
                                    <option value="academic">Academic</option>
                                    <option value="examination">Examination</option>
                                    <option value="general">General</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Filter by Status</label>
                                <select class="form-select" id="status-filter" onchange="filterAnnouncements()">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="expired">Expired</option>
                                    <option value="draft">Draft</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Search</label>
                                <input type="text" class="form-control" id="search-announcements" placeholder="Search announcements...">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Actions</label>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createAnnouncementModal">
                                        <i class="fas fa-plus"></i> Create
                                    </button>
                                    <button class="btn btn-info btn-sm" onclick="exportAnnouncements()">
                                        <i class="fas fa-download"></i> Export
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Announcements Summary -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Announcements Summary</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="card bg-primary text-white text-center">
                                    <div class="card-body">
                                        <h3>12</h3>
                                        <p class="mb-0">Total Announcements</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-success text-white text-center">
                                    <div class="card-body">
                                        <h3>10</h3>
                                        <p class="mb-0">Active</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-warning text-white text-center">
                                    <div class="card-body">
                                        <h3>1</h3>
                                        <p class="mb-0">Draft</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-info text-white text-center">
                                    <div class="card-body">
                                        <h3>1</h3>
                                        <p class="mb-0">Urgent</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Announcements List -->
                <div class="card">
                    <div class="card-header">
                        <h5>Announcements List</h5>
                    </div>
                    <div class="card-body">
                        <div id="announcements-list">
                            <!-- Announcements will be populated here -->
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Create Announcement Modal -->
    <div class="modal fade" id="createAnnouncementModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Announcement</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="create-announcement-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Title</label>
                                    <input type="text" class="form-control" id="announcement-title" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Type</label>
                                    <select class="form-select" id="announcement-type" required>
                                        <option value="">Select Type</option>
                                        <option value="academic">Academic</option>
                                        <option value="examination">Examination</option>
                                        <option value="general">General</option>
                                        <option value="urgent">Urgent</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Target Audience</label>
                                    <select class="form-select" id="target-audience" required>
                                        <option value="">Select Audience</option>
                                        <option value="my-class">My Class Only</option>
                                        <option value="all-students">All Students</option>
                                        <option value="teachers">Teachers Only</option>
                                        <option value="specific-class">Specific Class</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Priority</label>
                                    <select class="form-select" id="priority" required>
                                        <option value="normal">Normal</option>
                                        <option value="high">High</option>
                                        <option value="urgent">Urgent</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Start Date</label>
                                    <input type="datetime-local" class="form-control" id="start-date" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">End Date</label>
                                    <input type="datetime-local" class="form-control" id="end-date" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Content</label>
                            <textarea class="form-control" id="announcement-content" rows="6" required placeholder="Enter announcement content..."></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="send-notification">
                                <label class="form-check-label" for="send-notification">
                                    Send notification to target audience
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-warning" onclick="saveDraft()">Save Draft</button>
                    <button type="button" class="btn btn-primary" onclick="publishAnnouncement()">Publish</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Announcement Modal -->
    <div class="modal fade" id="viewAnnouncementModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="view-announcement-title">Announcement Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="view-announcement-content">
                        <!-- Announcement content will be populated here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="editAnnouncement()">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button type="button" class="btn btn-danger" onclick="deleteAnnouncement()">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/main.js"></script>
    <script src="../../assets/js/users/class-teacher.js"></script>
    <script>
        // Announcements Functionality
        let announcements = [];
        let currentAnnouncementId = 2001;
        
        // Sample announcements data
        const sampleAnnouncements = [
            {
                id: 2001,
                title: 'Class Test Schedule',
                type: 'academic',
                content: 'Mathematics class test will be held on Friday, October 20th, 2023, at 10:00 AM. All students are required to be present.',
                targetAudience: 'my-class',
                priority: 'high',
                startDate: '2023-10-19T08:00:00',
                endDate: '2023-10-21T17:00:00',
                status: 'active',
                createdBy: 'Class Teacher',
                createdAt: '2023-10-18T10:00:00',
                views: 28
            },
            {
                id: 2002,
                title: 'Parent Meeting Reminder',
                type: 'general',
                content: 'Reminder: Parent-teacher meeting for S.4 Science A class will be held on Saturday, October 21st, 2023, from 9:00 AM to 12:00 PM.',
                targetAudience: 'my-class',
                priority: 'normal',
                startDate: '2023-10-20T09:00:00',
                endDate: '2023-10-22T12:00:00',
                status: 'active',
                createdBy: 'Class Teacher',
                createdAt: '2023-10-17T14:30:00',
                views: 35
            },
            {
                id: 2003,
                title: 'Assignment Submission',
                type: 'academic',
                content: 'Physics assignment on "Waves and Oscillations" is due on Monday, October 23rd, 2023. Late submissions will not be accepted.',
                targetAudience: 'my-class',
                priority: 'normal',
                startDate: '2023-10-22T08:00:00',
                endDate: '2023-10-24T17:00:00',
                status: 'active',
                createdBy: 'Class Teacher',
                createdAt: '2023-10-16T16:00:00',
                views: 42
            },
            {
                id: 2004,
                title: 'Urgent: Class Trip Cancelled',
                type: 'urgent',
                content: 'Due to unforeseen circumstances, the planned class trip to the Science Museum has been cancelled. We will reschedule for a later date.',
                targetAudience: 'my-class',
                priority: 'urgent',
                startDate: '2023-10-19T18:00:00',
                endDate: '2023-10-21T08:00:00',
                status: 'active',
                createdBy: 'Class Teacher',
                createdAt: '2023-10-19T17:30:00',
                views: 38
            },
            {
                id: 2005,
                title: 'Study Group Formation',
                type: 'academic',
                content: 'Students are encouraged to form study groups for the upcoming examinations. Please coordinate with your classmates.',
                targetAudience: 'my-class',
                priority: 'normal',
                startDate: '2023-10-20T15:00:00',
                endDate: '2023-10-25T15:00:00',
                status: 'draft',
                createdBy: 'Class Teacher',
                createdAt: '2023-10-20T09:00:00',
                views: 0
            }
        ];
        
        function initializeAnnouncements() {
            announcements = [...sampleAnnouncements];
            displayAnnouncements();
        }
        
        function displayAnnouncements() {
            const container = document.getElementById('announcements-list');
            container.innerHTML = '';
            
            announcements.forEach(announcement => {
                const announcementCard = document.createElement('div');
                announcementCard.className = 'card mb-3';
                announcementCard.innerHTML = `
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <h5 class="card-title">
                                    ${announcement.title}
                                    <span class="badge ${getTypeColor(announcement.type)} ms-2">${announcement.type.toUpperCase()}</span>
                                    <span class="badge ${getPriorityColor(announcement.priority)} ms-1">${announcement.priority.toUpperCase()}</span>
                                </h5>
                                <p class="card-text">${announcement.content.substring(0, 150)}${announcement.content.length > 150 ? '...' : ''}</p>
                                <small class="text-muted">
                                    <i class="fas fa-user me-1"></i> ${announcement.createdBy} | 
                                    <i class="fas fa-calendar me-1"></i> ${formatDate(announcement.createdAt)} | 
                                    <i class="fas fa-eye me-1"></i> ${announcement.views} views
                                </small>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="mb-2">
                                    <span class="badge ${getStatusColor(announcement.status)}">${announcement.status.toUpperCase()}</span>
                                </div>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewAnnouncement(${announcement.id})">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning" onclick="editAnnouncement(${announcement.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteAnnouncement(${announcement.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(announcementCard);
            });
        }
        
        function getTypeColor(type) {
            switch(type.toLowerCase()) {
                case 'academic': return 'bg-primary';
                case 'examination': return 'bg-warning';
                case 'general': return 'bg-info';
                case 'urgent': return 'bg-danger';
                default: return 'bg-secondary';
            }
        }
        
        function getPriorityColor(priority) {
            switch(priority.toLowerCase()) {
                case 'urgent': return 'bg-danger';
                case 'high': return 'bg-warning';
                case 'normal': return 'bg-success';
                default: return 'bg-secondary';
            }
        }
        
        function getStatusColor(status) {
            switch(status.toLowerCase()) {
                case 'active': return 'bg-success';
                case 'expired': return 'bg-secondary';
                case 'draft': return 'bg-warning';
                default: return 'bg-info';
            }
        }
        
        function viewAnnouncement(announcementId) {
            const announcement = announcements.find(a => a.id === announcementId);
            if (!announcement) return;
            
            // Update views
            announcement.views++;
            
            // Populate modal
            document.getElementById('view-announcement-title').textContent = announcement.title;
            document.getElementById('view-announcement-content').innerHTML = `
                <div class="mb-3">
                    <h6>Content:</h6>
                    <p>${announcement.content}</p>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <p><strong>Type:</strong> ${announcement.type}</p>
                        <p><strong>Priority:</strong> ${announcement.priority}</p>
                        <p><strong>Target Audience:</strong> ${announcement.targetAudience}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Start Date:</strong> ${formatDate(announcement.startDate)}</p>
                        <p><strong>End Date:</strong> ${formatDate(announcement.endDate)}</p>
                        <p><strong>Status:</strong> ${announcement.status}</p>
                    </div>
                </div>
                <div class="mb-3">
                    <p><strong>Created by:</strong> ${announcement.createdBy}</p>
                    <p><strong>Created at:</strong> ${formatDate(announcement.createdAt)}</p>
                    <p><strong>Views:</strong> ${announcement.views}</p>
                </div>
            `;
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('viewAnnouncementModal'));
            modal.show();
            
            // Update display
            displayAnnouncements();
        }
        
        function editAnnouncement(announcementId) {
            if (announcementId) {
                const announcement = announcements.find(a => a.id === announcementId);
                if (announcement) {
                    alert(`Edit Announcement:\n\nTitle: ${announcement.title}\n\nThis feature will open the edit form for the announcement.`);
                }
            } else {
                alert('Edit Announcement feature:\n\nThis will open the edit form for the announcement.');
            }
        }
        
        function deleteAnnouncement(announcementId) {
            if (announcementId) {
                if (confirm('Are you sure you want to delete this announcement?')) {
                    announcements = announcements.filter(a => a.id !== announcementId);
                    displayAnnouncements();
                    showNotification('Announcement deleted successfully!', 'success');
                }
            } else {
                if (confirm('Are you sure you want to delete this announcement?')) {
                    showNotification('Announcement deleted successfully!', 'success');
                    
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('viewAnnouncementModal'));
                    modal.hide();
                }
            }
        }
        
        function publishAnnouncement() {
            const title = document.getElementById('announcement-title').value;
            const type = document.getElementById('announcement-type').value;
            const content = document.getElementById('announcement-content').value;
            const targetAudience = document.getElementById('target-audience').value;
            const priority = document.getElementById('priority').value;
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            const sendNotification = document.getElementById('send-notification').checked;
            
            if (!title || !type || !content || !targetAudience || !priority || !startDate || !endDate) {
                alert('Please fill in all required fields.');
                return;
            }
            
            const newAnnouncement = {
                id: currentAnnouncementId++,
                title,
                type,
                content,
                targetAudience,
                priority,
                startDate,
                endDate,
                status: 'active',
                createdBy: 'Class Teacher',
                createdAt: new Date().toISOString(),
                views: 0
            };
            
            announcements.unshift(newAnnouncement);
            displayAnnouncements();
            
            // Close modal and reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById('createAnnouncementModal'));
            modal.hide();
            document.getElementById('create-announcement-form').reset();
            
            if (sendNotification) {
                showNotification('Announcement published and notification sent!', 'success');
            } else {
                showNotification('Announcement published successfully!', 'success');
            }
        }
        
        function saveDraft() {
            const title = document.getElementById('announcement-title').value;
            const type = document.getElementById('announcement-type').value;
            const content = document.getElementById('announcement-content').value;
            const targetAudience = document.getElementById('target-audience').value;
            const priority = document.getElementById('priority').value;
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            if (!title || !type || !content || !targetAudience || !priority || !startDate || !endDate) {
                alert('Please fill in all required fields.');
                return;
            }
            
            const newAnnouncement = {
                id: currentAnnouncementId++,
                title,
                type,
                content,
                targetAudience,
                priority,
                startDate,
                endDate,
                status: 'draft',
                createdBy: 'Class Teacher',
                createdAt: new Date().toISOString(),
                views: 0
            };
            
            announcements.unshift(newAnnouncement);
            displayAnnouncements();
            
            // Close modal and reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById('createAnnouncementModal'));
            modal.hide();
            document.getElementById('create-announcement-form').reset();
            
            showNotification('Announcement saved as draft!', 'success');
        }
        
        function filterAnnouncements() {
            const typeFilter = document.getElementById('type-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            const searchTerm = document.getElementById('search-announcements').value.toLowerCase();
            
            let filteredAnnouncements = announcements;
            
            if (typeFilter) {
                filteredAnnouncements = filteredAnnouncements.filter(a => a.type === typeFilter);
            }
            
            if (statusFilter) {
                filteredAnnouncements = filteredAnnouncements.filter(a => a.status === statusFilter);
            }
            
            if (searchTerm) {
                filteredAnnouncements = filteredAnnouncements.filter(a => 
                    a.title.toLowerCase().includes(searchTerm) ||
                    a.content.toLowerCase().includes(searchTerm)
                );
            }
            
            displayFilteredAnnouncements(filteredAnnouncements);
        }
        
        function displayFilteredAnnouncements(filteredAnnouncements) {
            const container = document.getElementById('announcements-list');
            container.innerHTML = '';
            
            filteredAnnouncements.forEach(announcement => {
                const announcementCard = document.createElement('div');
                announcementCard.className = 'card mb-3';
                announcementCard.innerHTML = `
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <h5 class="card-title">
                                    ${announcement.title}
                                    <span class="badge ${getTypeColor(announcement.type)} ms-2">${announcement.type.toUpperCase()}</span>
                                    <span class="badge ${getPriorityColor(announcement.priority)} ms-1">${announcement.priority.toUpperCase()}</span>
                                </h5>
                                <p class="card-text">${announcement.content.substring(0, 150)}${announcement.content.length > 150 ? '...' : ''}</p>
                                <small class="text-muted">
                                    <i class="fas fa-user me-1"></i> ${announcement.createdBy} | 
                                    <i class="fas fa-calendar me-1"></i> ${formatDate(announcement.createdAt)} | 
                                    <i class="fas fa-eye me-1"></i> ${announcement.views} views
                                </small>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="mb-2">
                                    <span class="badge ${getStatusColor(announcement.status)}">${announcement.status.toUpperCase()}</span>
                                </div>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewAnnouncement(${announcement.id})">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning" onclick="editAnnouncement(${announcement.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteAnnouncement(${announcement.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(announcementCard);
            });
        }
        
        function exportAnnouncements() {
            alert('Export Announcements feature:\n\nThis will download the announcements as a PDF or Excel file.');
        }
        
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '../../index.html';
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeAnnouncements();
        });
    </script>
</body>
</html>